name: akari-bootstrap
on: [push, workflow_dispatch]

jobs:
  boot:
    runs-on: ubuntu-latest
    env:
      N8N_KEY:           ${{ secrets.N8N_PERSONAL_API_KEY }}
      RENDER_SERVICE:    ${{ secrets.RENDER_SERVICE }}
      RENDER_API_TOKEN:  ${{ secrets.RENDER_API_TOKEN }}
      N8N_DOMAIN:        n8n-xl04.onrender.com
    steps:
      - uses: actions/checkout@v4

      - name: Inject env var into Render
        run: |
          curl -s -X PUT "https://api.render.com/v1/services/${RENDER_SERVICE}/env-vars" \
               -H "Authorization: Bearer ${RENDER_API_TOKEN}" \
               -H "Content-Type: application/json" \
               -d '[{"key":"N8N_PERSONAL_API_KEY","value":"'"${N8N_KEY}"'"}]'

      - name: Download bootstrap workflows
        run: |
          curl -sL https://raw.githubusercontent.com/AInoAKARI/bootstrap-assets/main/inbox_supervisor.json -o /tmp/wf.json

      - name: Import workflows into n8n
        run: |
          curl -s -X POST "https://${N8N_DOMAIN}/rest/workflows" \
               -H "X-N8N-API-KEY: ${N8N_KEY}" \
               -H "Content-Type: application/json" \
               --data-binary @/tmp/wf.json
